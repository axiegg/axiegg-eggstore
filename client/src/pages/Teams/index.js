/* eslint react/prop-types: 0 */
import React, { useEffect, useState } from 'react';
import { connect } from 'react-redux';

import styles from './index.module.sass';

import { FullHeight, Container } from 'components/Layout';
import { Image } from 'components/Image';
import Loader from 'components/Loader';

import { AXIE_TOKEN_ADDRESS, EGGS_WALLET, ERC20Mappings } from 'shared/constants';

import { buyOrder } from 'services/Opensea';
import { BNToNumber, BNToETH } from 'services/Web3Service';

import Bundle from './Bundle';

const Teams = ({ opensea }) => {
  const [bundlesList, setBundlesList] = useState(null);
  const [count, setCount] = useState(0);
  const [order, setOrder] = useState(null);

  const rotateCounter = (direction, length) => {
    let result = null;
    if (direction === 'left') {
      result = (count === 0) ? length : count - 1;
    } else {
      result = (count === length) ? 0 : count + 1;
    }

    if (bundlesList[count].sellOrders.length > 0) {
      const sortedSellOrders = bundlesList[result].sellOrders.sort((a, b) => BNToETH(a.basePrice) > BNToETH(b.basePrice));
      setOrder(sortedSellOrders[0]);
    }

    setCount(result);
  };

  useEffect(() => {
    const getOrders = async () => {
      const { bundles } = await opensea.api.getBundles({
        owner: EGGS_WALLET,
        asset_contract_address: AXIE_TOKEN_ADDRESS,
        on_sale: true,
      });

      console.log(bundles);

      if (bundles[count].sellOrders.length > 0) {
        const sortedSellOrders = bundles[count].sellOrders.sort((a, b) => BNToETH(a.basePrice) > BNToETH(b.basePrice));
        setOrder(sortedSellOrders[0]);
      }

      setBundlesList(bundles);
    };

    if (opensea !== null) {
      getOrders();
    }
  }, [opensea]);

  return (
    <FullHeight className={styles.fullHeight}>
      <Container className={styles.container}>
        <h1 className={styles.title}>AXIE.GG Team Store</h1>
        {bundlesList !== null
          ? bundlesList.length > 0
            ? (
              <div className={styles.bundle}>

                <div className={styles.topLayer} />

                <div className={styles.grid}>

                  <div role="button" className={styles.leftArrow} onClick={() => { rotateCounter('left', bundlesList.length - 1) }} tabIndex={count}>
                    <svg viewBox="0 0 20 41" width="40" height="82"><path id="selection-arrow-left" fill="#ffffff" d="M19.6394073,38.0116645 C19.7591855,38.5667613 19.8370282,39.1146323 19.8569476,39.6821161 C19.8671694,39.9706323 19.8925927,40.5905032 19.4698306,40.6434065 C19.2386613,40.6720516 18.9679153,40.3564387 18.8093468,40.221471 C18.5619274,40.0106323 18.3412419,39.7716645 18.1085,39.5458581 C17.6776129,39.1275355 17.2603548,38.6957935 16.8347097,38.2725677 C15.9962621,37.4390194 15.202371,36.5639226 14.397996,35.6994065 C13.7736815,35.0284387 13.1540847,34.3510194 12.540254,33.6705032 C12.261121,33.3613419 11.811625,33.021471 11.8509395,32.5566968 C11.8892056,32.1068903 12.3156371,31.7339871 12.6131169,31.4276645 C13.5359597,30.4764387 14.4205363,29.5290839 15.4358992,28.6681806 C15.839004,28.3265032 16.6294879,27.6219871 17.1418871,28.1641806 C17.4702944,28.5117935 17.6327944,28.9889548 17.7625323,29.4364387 C17.9098306,29.9435355 18.1470282,30.3383742 17.7772097,30.7778581 C17.3935,31.2338581 16.870879,31.6496 16.6824315,32.2338581 C16.5390645,32.6785032 16.8467661,33.1373419 17.1017863,33.4787613 C17.6839032,34.2576 18.2890847,34.9907613 18.8879758,35.7561806 C19.297371,36.2792774 19.4064032,37.0268903 19.5565847,37.6506323 C19.5862016,37.7726968 19.6137218,37.8926968 19.6394073,38.0116645 Z M13.1982317,18.281404 C12.5526782,17.7990414 11.8883944,17.3428279 11.1727948,16.9274883 C9.89862212,16.1876964 8.503344,17.0874296 7.57478358,17.9579672 C6.6446837,18.830028 5.39745182,20.2075541 5.24607004,21.5178033 C5.12676068,22.5513287 5.89957747,23.3429111 6.52896644,24.0580772 C7.10498692,24.7123132 8.00352756,25.4424579 8.89770635,25.6074767 C9.32311479,25.6859241 9.84089178,25.3680725 10.1657211,25.1284144 C10.7060771,24.7300845 11.7608745,23.6371523 11.1035184,22.9377265 C10.9975512,22.825006 10.8125575,22.8178975 10.6691297,22.877812 C10.5257019,22.9379804 10.412807,23.0509548 10.3014516,23.1585978 C9.81985228,23.6229353 9.3007924,23.9082909 8.67550869,23.5581972 C7.72744826,23.0273444 7.05059212,21.9686854 7.64534289,20.9465844 C8.17954095,20.0278106 9.2438318,18.8772488 10.4587347,19.1031976 C11.7457364,19.3426018 12.7171455,20.3527706 13.7013836,21.1179501 C14.4218582,21.6779985 15.0394446,22.3604146 15.5592742,23.1047763 C15.7601758,23.3926706 15.9513273,23.7079835 15.9646694,24.0565539 C15.9985379,24.9532407 15.18005,25.7415227 14.6563717,26.3754488 C13.8922786,27.2998079 13.030942,28.1459734 12.0869868,28.8900813 C11.3128871,29.500143 9.93454322,30.7162046 8.8499826,30.1965223 C7.49755322,29.5486332 6.58797968,28.5204392 5.43183344,27.6280683 C4.01962109,26.5384365 2.7192773,25.1946758 1.54311788,23.8641166 C1.02893301,23.282235 0.188379288,22.3086241 0.030326452,21.5492838 C-0.170575124,20.5840508 0.672287809,19.4659851 1.21572272,18.7538655 C2.5347968,17.0242147 4.05682508,15.5014721 5.63016923,13.9952313 C6.60773628,13.059194 7.6389284,11.9880951 8.82124572,11.3051712 C9.64537837,10.8289016 10.1918922,10.8817076 11.0450183,11.307456 C12.5306124,12.0482635 13.7303771,13.2267515 14.8642009,14.4072706 C16.0239393,15.6144465 17.2367895,16.7479986 18.2525869,18.0760191 C19.0030813,19.0567385 19.7699967,20.1410388 19.9788523,21.3812185 C20.1338262,22.3015156 19.4053976,23.3325023 18.8273245,24.0128874 C18.6949296,24.1685128 17.7915139,25.1505016 17.757902,24.4234034 C17.7242901,23.6996056 17.8761851,23.2309522 17.6149874,22.5208637 C17.1811118,21.341614 15.958255,20.4789466 15.0063458,19.7069125 C14.4015885,19.2164259 13.8081206,18.7371098 13.1982317,18.281404 Z M19.1404955,2.54605047 C19.1156781,2.66106467 19.089088,2.77707683 19.0604719,2.8950849 C18.9153658,3.49809863 18.8100183,4.22086685 18.4144586,4.72658006 C17.8358069,5.46656298 17.2510774,6.17535984 16.6886331,6.92831617 C16.4422313,7.25838947 16.1449284,7.70198004 16.2834502,8.13184875 C16.4655293,8.69669074 16.9704883,9.09861673 17.3412306,9.53946293 C17.6985512,9.96434186 17.4693697,10.3460593 17.3270492,10.8363042 C17.2016958,11.2689173 17.0446874,11.7302215 16.7273787,12.0662826 C16.2322959,12.5904579 15.4685263,11.9093543 15.0790443,11.5790315 C14.0979955,10.7467378 13.243313,9.83086551 12.3516576,8.91125086 C12.064231,8.61510799 11.6522107,8.2545971 11.6152378,7.81973862 C11.5772519,7.37040981 12.0115572,7.04183344 12.281257,6.74294621 C12.8743434,6.085045 13.473001,5.43013766 14.0762169,4.78146753 C14.8534082,3.94568102 15.6204699,3.09966548 16.4305822,2.29381759 C16.8418428,1.88465643 17.2449997,1.46726215 17.661325,1.06284127 C17.8862015,0.844538824 18.0994289,0.613512463 18.3384868,0.409680349 C18.4916966,0.279197858 18.7532927,-0.0259265916 18.9766497,0.00176663315 C19.3851246,0.052911778 19.3605604,0.652183182 19.3506841,0.931111337 C19.3314379,1.47973657 19.2562259,2.00940068 19.1404955,2.54605047 Z" /></svg>
                  </div>

                  <Bundle bundle={bundlesList[count]} order={order} />

                  <div role="button" className={styles.rightArrow} onClick={() => { rotateCounter('right', bundlesList.length - 1) }} tabIndex={count}>
                    <svg viewBox="0 0 20 41" width="40" height="82"><path id="selection-arrow-left" fill="#ffffff" d="M19.6394073,38.0116645 C19.7591855,38.5667613 19.8370282,39.1146323 19.8569476,39.6821161 C19.8671694,39.9706323 19.8925927,40.5905032 19.4698306,40.6434065 C19.2386613,40.6720516 18.9679153,40.3564387 18.8093468,40.221471 C18.5619274,40.0106323 18.3412419,39.7716645 18.1085,39.5458581 C17.6776129,39.1275355 17.2603548,38.6957935 16.8347097,38.2725677 C15.9962621,37.4390194 15.202371,36.5639226 14.397996,35.6994065 C13.7736815,35.0284387 13.1540847,34.3510194 12.540254,33.6705032 C12.261121,33.3613419 11.811625,33.021471 11.8509395,32.5566968 C11.8892056,32.1068903 12.3156371,31.7339871 12.6131169,31.4276645 C13.5359597,30.4764387 14.4205363,29.5290839 15.4358992,28.6681806 C15.839004,28.3265032 16.6294879,27.6219871 17.1418871,28.1641806 C17.4702944,28.5117935 17.6327944,28.9889548 17.7625323,29.4364387 C17.9098306,29.9435355 18.1470282,30.3383742 17.7772097,30.7778581 C17.3935,31.2338581 16.870879,31.6496 16.6824315,32.2338581 C16.5390645,32.6785032 16.8467661,33.1373419 17.1017863,33.4787613 C17.6839032,34.2576 18.2890847,34.9907613 18.8879758,35.7561806 C19.297371,36.2792774 19.4064032,37.0268903 19.5565847,37.6506323 C19.5862016,37.7726968 19.6137218,37.8926968 19.6394073,38.0116645 Z M13.1982317,18.281404 C12.5526782,17.7990414 11.8883944,17.3428279 11.1727948,16.9274883 C9.89862212,16.1876964 8.503344,17.0874296 7.57478358,17.9579672 C6.6446837,18.830028 5.39745182,20.2075541 5.24607004,21.5178033 C5.12676068,22.5513287 5.89957747,23.3429111 6.52896644,24.0580772 C7.10498692,24.7123132 8.00352756,25.4424579 8.89770635,25.6074767 C9.32311479,25.6859241 9.84089178,25.3680725 10.1657211,25.1284144 C10.7060771,24.7300845 11.7608745,23.6371523 11.1035184,22.9377265 C10.9975512,22.825006 10.8125575,22.8178975 10.6691297,22.877812 C10.5257019,22.9379804 10.412807,23.0509548 10.3014516,23.1585978 C9.81985228,23.6229353 9.3007924,23.9082909 8.67550869,23.5581972 C7.72744826,23.0273444 7.05059212,21.9686854 7.64534289,20.9465844 C8.17954095,20.0278106 9.2438318,18.8772488 10.4587347,19.1031976 C11.7457364,19.3426018 12.7171455,20.3527706 13.7013836,21.1179501 C14.4218582,21.6779985 15.0394446,22.3604146 15.5592742,23.1047763 C15.7601758,23.3926706 15.9513273,23.7079835 15.9646694,24.0565539 C15.9985379,24.9532407 15.18005,25.7415227 14.6563717,26.3754488 C13.8922786,27.2998079 13.030942,28.1459734 12.0869868,28.8900813 C11.3128871,29.500143 9.93454322,30.7162046 8.8499826,30.1965223 C7.49755322,29.5486332 6.58797968,28.5204392 5.43183344,27.6280683 C4.01962109,26.5384365 2.7192773,25.1946758 1.54311788,23.8641166 C1.02893301,23.282235 0.188379288,22.3086241 0.030326452,21.5492838 C-0.170575124,20.5840508 0.672287809,19.4659851 1.21572272,18.7538655 C2.5347968,17.0242147 4.05682508,15.5014721 5.63016923,13.9952313 C6.60773628,13.059194 7.6389284,11.9880951 8.82124572,11.3051712 C9.64537837,10.8289016 10.1918922,10.8817076 11.0450183,11.307456 C12.5306124,12.0482635 13.7303771,13.2267515 14.8642009,14.4072706 C16.0239393,15.6144465 17.2367895,16.7479986 18.2525869,18.0760191 C19.0030813,19.0567385 19.7699967,20.1410388 19.9788523,21.3812185 C20.1338262,22.3015156 19.4053976,23.3325023 18.8273245,24.0128874 C18.6949296,24.1685128 17.7915139,25.1505016 17.757902,24.4234034 C17.7242901,23.6996056 17.8761851,23.2309522 17.6149874,22.5208637 C17.1811118,21.341614 15.958255,20.4789466 15.0063458,19.7069125 C14.4015885,19.2164259 13.8081206,18.7371098 13.1982317,18.281404 Z M19.1404955,2.54605047 C19.1156781,2.66106467 19.089088,2.77707683 19.0604719,2.8950849 C18.9153658,3.49809863 18.8100183,4.22086685 18.4144586,4.72658006 C17.8358069,5.46656298 17.2510774,6.17535984 16.6886331,6.92831617 C16.4422313,7.25838947 16.1449284,7.70198004 16.2834502,8.13184875 C16.4655293,8.69669074 16.9704883,9.09861673 17.3412306,9.53946293 C17.6985512,9.96434186 17.4693697,10.3460593 17.3270492,10.8363042 C17.2016958,11.2689173 17.0446874,11.7302215 16.7273787,12.0662826 C16.2322959,12.5904579 15.4685263,11.9093543 15.0790443,11.5790315 C14.0979955,10.7467378 13.243313,9.83086551 12.3516576,8.91125086 C12.064231,8.61510799 11.6522107,8.2545971 11.6152378,7.81973862 C11.5772519,7.37040981 12.0115572,7.04183344 12.281257,6.74294621 C12.8743434,6.085045 13.473001,5.43013766 14.0762169,4.78146753 C14.8534082,3.94568102 15.6204699,3.09966548 16.4305822,2.29381759 C16.8418428,1.88465643 17.2449997,1.46726215 17.661325,1.06284127 C17.8862015,0.844538824 18.0994289,0.613512463 18.3384868,0.409680349 C18.4916966,0.279197858 18.7532927,-0.0259265916 18.9766497,0.00176663315 C19.3851246,0.052911778 19.3605604,0.652183182 19.3506841,0.931111337 C19.3314379,1.47973657 19.2562259,2.00940068 19.1404955,2.54605047 Z" /></svg>
                  </div>

                </div>

                <div className={styles.bottomLayer} />
              </div>
            )
            : <p>Teams temporarily out-of-stock!  Contact us on Discord to purchase Axies.</p>
          : <Loader />
        }
      </Container>
    </FullHeight>
  );
};

const mapStateToProps = ({ opensea }) => ({
  opensea,
});

export default connect(mapStateToProps)(Teams);
